---
title: íŠ¸ëœì­ì…˜ê³¼ ê²©ë¦¬ìˆ˜ì¤€
slug: transaction-and-isolation
tags: [DataBase, Transaction, Isolation]
---

## íŠ¸ëœì­ì…˜(Transaction)

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë…¼ë¦¬ì  ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì‘ì—…ì˜ ë‹¨ìœ„ë¥¼ ë§í•œë‹¤.  
íŠ¸ëœì­ì…˜ì€ ì‘ì—…ì˜ ì™„ì „ì„±ê³¼ ë°ì´í„°ì˜ ì •í•©ì„±ì„ ë³´ì¥í•´ ì¤€ë‹¤.  
ë…¼ë¦¬ì ì¸ ì‘ì—… ì…‹ì„ ì™„ë²½í•˜ê²Œ ì²˜ë¦¬í•˜ê±°ë‚˜, ì˜¤ë¥˜ ì‹œ ì‘ì—…ì˜ ì¼ë¶€ë§Œ ì ìš©ë˜ëŠ” í˜„ìƒì„ ë§‰ì•„ì¤€ë‹¤.  

### íŠ¸ëœì­ì…˜ì˜ ì†ì„±(ACID)

ì›ìì„±(Atomicity): íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ëœ ì‘ì—…ë“¤ì€ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜, ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.  
ì¼ê´€ì„±(Consistency): íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ë˜ê¸° ì „ê³¼ í›„ì— ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¼ê´€ëœ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤.  
ê²©ë¦¬ì„±(Isolation): ê°ê°ì˜ íŠ¸ëœì­ì…˜ì€ ë…ë¦½ì ì´ë¼ ì„œë¡œì—ê²Œ ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ í•œë‹¤.  
ì§€ì†ì„±(Durability): íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœë‹¤ë©´ ì˜êµ¬ì ìœ¼ë¡œ ê²°ê³¼ì— ë°˜ì˜ë˜ì–´ì•¼ í•œë‹¤.  

### íŠ¸ëœì­ì…˜ ì£¼ì˜ì‚¬í•­

íŠ¸ëœì­ì…˜ì€ ê¼­ í•„ìš”í•œ ìµœì†Œì˜ ì½”ë“œì—ë§Œ ì ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.(íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„ë¥¼ ìµœì†Œí™”í•˜ë¼)  
êµ¬í˜„í•´ì•¼ í•˜ëŠ” ì—…ë¬´ì— ë”°ë¼ íŠ¸ëœì­ì…˜ì„ ë¬¶ê±°ë‚˜ íŠ¸ëœì­ì…˜ì—ì„œ ì œì™¸í•˜ê³ , ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì´ ìˆëŠ” ê²½ìš° ë°˜ë“œì‹œ íŠ¸ëœì­ì…˜ì—ì„œ ë°°ì œí•´ì•¼ í•œë‹¤.  

:::info ì™œ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì´ ìˆì„ ë•Œ íŠ¸ëœì­ì…˜ì—ì„œ ë°°ì œí•´ì•¼ í• ê¹Œ? ğŸ¤”

ë°ì´í„°ì˜ ì¼ê´€ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ë°°ì œí•´ì•¼ í•œë‹¤.  
ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ íŠ¸ëœì­ì…˜ ë‚´ë¶€ì— í¬í•¨í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.  
- ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì´ ì¤‘ê°„ì— ì‹¤íŒ¨í•  ê°€ëŠ¥ì„±(ì•ˆì „ì„± X)
- í†µì‹ ìœ¼ë¡œ ì¸í•´ ë°ì´í„°ê°€ ë³€ê²½ë  ìˆ˜ ìˆëŠ” ë¶€ë¶„(ì¼ê´€ì„± X)

:::

## ê²©ë¦¬ ìˆ˜ì¤€(Isolation level)

ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì²˜ë¦¬ë  ë•Œ íŠ¹ì • íŠ¸ëœì­ì…˜ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë°ì´í„°ì˜ ì¡°íšŒ ë° ë³€ê²½ì„ í—ˆìš©í• ì§€ ê²°ì •í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.  
ê²©ë¦¬ ìˆ˜ì¤€ì´ ë†’ì•„ì§ˆ ìˆ˜ë¡ ë™ì‹œ ì²˜ë¦¬ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ì§€ë§Œ, `SERIALIZABLE`ì´ ì•„ë‹ˆë¼ë©´ í¬ê²Œ ì„±ëŠ¥ì˜ ì €í•˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.  

### READ UNCOMMITTED

ê° íŠ¸ëœì­ì…˜ì—ì„œì˜ ë³€ê²½ ë‚´ìš©ì´ `COMMIT`ì´ë‚˜ `ROLLBACK` ì—¬ë¶€ì— ìƒê´€ì—†ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³´ì¸ë‹¤.  
ë”í‹° ë¦¬ë“œ í˜„ìƒì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì •í•©ì„±ì˜ ë¬¸ì œê°€ ë§ì€ ê²©ë¦¬ ìˆ˜ì¤€ì´ë‹¤.  
MySQL ì‚¬ìš©ì‹œ ìµœì†Œ `READ COMMITTED` ì´ìƒì˜ ê²©ë¦¬ ìˆ˜ì¤€ ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤.  

```mermaid
---
title: READ UNCOMMITTED
---
sequenceDiagram
    Alice->>Database: BEGIN
    Alice->>Database: INSERT(Alice)
    Bob->>Database: SELECT
    Database->>+Bob: Alice
    Alice->>Database: COMMIT(Alice)
```

### READ COMMITTED

íŠ¸ëœì­ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë”ë¼ë„ `COMMIT`ì´ ì™„ë£Œëœ ë°ì´í„°ë§Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.  
ì˜¤ë¼í´ DBMSì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ë©°, ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ì—ì„œ ê°€ì¥ ë§ì´ ì„ íƒë˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ë‹¤.  
`REPEATABLE READ`ê°€ ë³´ì¥ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— `NON-REPEATABLE READ` ë¬¸ì œê°€ ë°œìƒí•œë‹¤.  

```mermaid
---
title: READ COMMITTED
---
sequenceDiagram
    Alice->>Database: BEGIN
    Alice->>Database: UPDATE(Alice to Bob)
    Bob->>Database: SELECT
    Database->>+Bob: Alice(Undo log)
    Alice->>Database: COMMIT
```

### REPEATABLE READ

íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê¸° ì „ì— `COMMIT`ì´ ì™„ë£Œëœ ë‚´ìš©ì— ëŒ€í•´ì„œë§Œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.  
MySQLì˜ InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ë‹¤.  
MVCCë¥¼ ì´ìš©í•´ ì–¸ë‘(Undo) ì˜ì—­ì— ë°±ì—…ëœ ì´ì „ ë°ì´í„°ë¥¼ ì´ìš©í•´ ë™ì¼ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œëŠ” ë™ì¼í•œ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ ë³´ì¥í•œë‹¤.  
ë™ì¼í•œ ê²°ê³¼ë¥¼ ë³´ì¥í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.  
  - ëª¨ë“  InnoDB íŠ¸ëœì­ì…˜ì€ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ê³ ìœ í•œ íŠ¸ëœì­ì…˜ ë²ˆí˜¸ë¥¼ ê°€ì§„ë‹¤.
  - Undo ì˜ì—­ì— ë°±ì—…ëœ ë ˆì½”ë“œì—ëŠ” ë³€ê²½ì„ ë°œìƒì‹œí‚¨ íŠ¸ëœì­ì…˜ì˜ ë²ˆí˜¸ê°€ í¬í•¨ë˜ì–´ìˆë‹¤.
  - Undo ì˜ì—­ì˜ ë°±ì—…ëœ ë°ì´í„°ëŠ” ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì´ ë¶ˆí•„ìš”í•˜ë‹¤ê³  íŒë‹¨í•˜ëŠ” ê²½ìš° ì‚­ì œëœë‹¤.
  - `REPEATABLE READ` ê²©ë¦¬ ìˆ˜ì¤€ì—ì„œëŠ” MVCCë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•´ ê°€ì¥ ì˜¤ë˜ëœ íŠ¸ëœì­ì…˜ ë²ˆí˜¸ë³´ë‹¤ ì•ì„  Undo ì˜ì—­ì˜ ë°ì´í„°ëŠ” ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤. 

InnoDBì—ì„œëŠ” ê°­ ë½ê³¼ ë„¥ìŠ¤íŠ¸ í‚¤ ë½ì„ ì´ìš©í•˜ì—¬ íŒ¬í…€ ë¦¬ë“œ í˜„ìƒì„ ë°©ì§€í•œë‹¤.  

```mermaid
---
title: REPEATABLE READ
---
sequenceDiagram
    participant Alice
    participant Database
    participant Bob
    Bob->>Database: BEGIN(TRX-ID: 1)
    Bob->>Database: SELECT
    Database->>+Bob: Alice
    Alice->>Database: BEGIN(TRX-ID: 2)
    Alice->>Database: UPDATE(Alice to Bob)
    Alice->>Database: COMMIT
    Bob->>Database: SELECT
    Database->>+Bob: Alice(Undo log)
```

:::note ê°­ ë(Gap lock)ê³¼ ë„¥ìŠ¤íŠ¸ í‚¤ ë½(Next-key lock)

ê°­ ë½: ë ˆì½”ë“œì™€ ë°”ë¡œ ì¸ì ‘í•œ ë ˆì½”ë“œ ì‚¬ì´ì˜ ê°„ê²©ë§Œì„ ì ê·¸ëŠ” ë½ì´ë‹¤.  
ë„¥ìŠ¤íŠ¸ í‚¤ ë½: ë ˆì½”ë“œ ë½ê³¼ ê°­ ë½ì„ í•©ì³ë†“ì€ í˜•íƒœì˜ ì ê¸ˆìœ¼ë¡œ ë ˆì½”ë“œì™€ ê·¸ ë ˆì½”ë“œ ì•ì˜ ê°­ ë½ì„ í¬í•¨í•œë‹¤.

:::

:::note MVCC(Multi Version Concurrency Control)

ë™ì‹œì„±ì„ ì œì–´í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ í•˜ë‚˜ì˜ ë ˆì½”ë“œì— ëŒ€í•´ ì—¬ëŸ¬ ê°œì˜ ë²„ì „ì´ ë™ì‹œì— ê´€ë¦¬ë˜ëŠ” ê²ƒì´ë‹¤.
  - PostgreSQLì€ ë‹¤ì¤‘ ë²„ì „ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒìœ¼ë¡œ MVCCë¥¼ êµ¬í˜„í•œë‹¤.
  - Oracle, InnoDBëŠ” `Undo log`ë¥¼ ì´ìš©í•´ ì´ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.(ìµœì‹  ë²„ì „ì˜ ë°ì´í„°ë§Œ DBì— ì €ì¥)

ì ê¸ˆì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½ê´€ëœ ì½ê¸°ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.

:::

### SERIALIZABLE

íŠ¸ëœì­ì…˜ì„ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰ì‹œí‚¤ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ê³  ë”°ë¼ì„œ ë™ì‹œ ì²˜ë¦¬ ì„±ëŠ¥ë„ ë‹¤ë¥¸ ê²©ë¦¬ ìˆ˜ì¤€ë³´ë‹¤ ë–¨ì–´ì§„ë‹¤.  
íŠ¸ëœì­ì…˜ì—ì„œ ì½ê³  ì“°ëŠ” ë ˆì½”ë“œë¥¼ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ê³  ë‹¨ìˆœí•œ ì½ê¸° ì‘ì—…ë„ ê³µìœ  ì ê¸ˆ(ì½ê¸° ì ê¸ˆ)ì„ íšë“í•´ì•¼ë§Œ í•œë‹¤.  
InnoDBì—ì„œëŠ” íŒ¬í…€ ë¦¬ë“œ í˜„ìƒì´ `REPEATABLE READ` ê²©ë¦¬ ìˆ˜ì¤€ì—ì„œ ë°œìƒí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— êµ³ì´ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ë‹¤.  

## ê²©ë¦¬ ìˆ˜ì¤€ì— ë”°ë¥¸ ë¶€ì •í•© ë¬¸ì œ

ê²©ë¦¬ ìˆ˜ì¤€ì— ë”°ë¼ ë”í‹° ë¦¬ë“œ, ë°˜ë³µ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ì¡°íšŒ, íŒ¬í…€ ë¦¬ë“œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.  

| ê²©ë¦¬ ìˆ˜ì¤€ / ë¶€ì •í•© ë¬¸ì œ | ë”í‹° ë¦¬ë“œ | ë°˜ë³µ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ì¡°íšŒ | íŒ¬í…€ ë¦¬ë“œ |
| --- | --- | --- | --- |
| READ UNCOMMITTED | O | O | O |
| READ COMMITTED | X | O | O |
| REPEATABLE READ | X | X | O(InnoDBëŠ” X) |
| SERIALIZABLE | X | X | X |

### ë”í‹° ë¦¬ë“œ(Dirty read)

ì–´ë–¤ íŠ¸ëœì­ì…˜ì—ì„œ ì²˜ë¦¬í•œ ì‘ì—…ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ì–´ë„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” í˜„ìƒ  
íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì´ READ UNCOMMITTEDì¼ ë•Œ ë°œìƒí•œë‹¤.  
ì˜ˆ) Bê°€ ë ˆì½”ë“œë¥¼ ì¶”ê°€í•˜ê³  ì»¤ë°‹ì„ í•˜ì§€ ì•Šì•˜ì§€ë§Œ, Aê°€ í•´ë‹¹ ë ˆì½”ë“œë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ê²½ìš°

### ë°˜ë³µ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ì¡°íšŒ(Non-repeatable read)

í•œ íŠ¸ëœì­ì…˜ ë‚´ì˜ ê°™ì€ í–‰ì— ë‘ ë²ˆ ì´ìƒ ì¡°íšŒê°€ ë°œìƒí–ˆëŠ”ë°, ê·¸ ê°’ì´ ë‹¤ë¥¸ í˜„ìƒ  
ì˜ˆ) Aê°€ ë ˆì½”ë“œë¥¼ ì—¬ëŸ¬ ë²ˆ ì¡°íšŒí•˜ë˜ ì¤‘ Bê°€ ë ˆì½”ë“œë¥¼ ë³€ê²½í•˜ì—¬ Aê°€ ì¡°íšŒí•œ ê°’ì´ ë‹¬ë¼ì§€ëŠ” ê²½ìš°  

```mermaid
---
title: NON REPEATABLE READ
---
sequenceDiagram
    participant Alice
    participant Database
    participant Bob
    Bob->>Database: BEGIN
    Bob->>Database: SELECT
    Database->>+Bob: Alice
    Alice->>Database: BEGIN
    Alice->>Database: UPDATE(Alice to Bob)
    Alice->>Database: COMMIT
    Bob->>Database: SELECT
    Database->>+Bob: Bob
```

### íŒ¬í…€ ë¦¬ë“œ(Phantom read, Phantom row)

í•œ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì¼í•œ ì¿¼ë¦¬ ìˆ˜í–‰ì‹œ, ìˆ˜í–‰ ê²°ê³¼ê°€ ë‹¤ë¥¸ í˜„ìƒ  
ì˜ˆ) Aê°€ ë ˆì½”ë“œë¥¼ ì¡°íšŒí•˜ê³  Bê°€ ë ˆì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ Aê°€ ë‹¤ì‹œ ì¡°íšŒí•  ë•Œ ì¡´ì¬í•˜ì§€ ì•Šì€ ë ˆì½”ë“œê°€ ì¡°íšŒë˜ëŠ” ê²½ìš°  

```mermaid
---
title: PHANTOM READ
---
sequenceDiagram
    participant Alice
    participant Database
    participant Bob
    Bob->>Database: BEGIN(TRX-ID: 1)
    Bob->>Database: SELECT COUNT
    Database->>+Bob: 1
    Alice->>Database: BEGIN(TRX-ID: 2)
    Alice->>Database: INSERT(Bob)
    Alice->>Database: COMMIT
    Bob->>Database: SELECT COUNT
    Database->>+Bob: 2
```

## ì°¸ê³  ìë£Œ

Real My SQL 8.0 - 5ì¥ íŠ¸ëœì­ì…˜ê³¼ ì ê¸ˆ, ë°±ì€ë¹ˆ, ì´ì„±ìš±  
[Isolation Level, MySQL](https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html)