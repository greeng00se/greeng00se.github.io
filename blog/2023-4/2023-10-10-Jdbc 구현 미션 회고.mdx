---
title: Jdbc ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬í˜„ ë¯¸ì…˜ íšŒê³ 
slug: jdbc-retrospective
tags: [Woowahan Techcourse, Retrospective]
---

:::note PR ë§í¬
1ë‹¨ê³„: https://github.com/woowacourse/jwp-dashboard-jdbc/pull/267  
2ë‹¨ê³„: https://github.com/woowacourse/jwp-dashboard-jdbc/pull/358  
3ë‹¨ê³„: https://github.com/woowacourse/jwp-dashboard-jdbc/pull/448  
4ë‹¨ê³„: https://github.com/woowacourse/jwp-dashboard-jdbc/pull/515  
:::

### Jdbc êµ¬í˜„

ì´ë²ˆ ë¯¸ì…˜ì€ Jdbc ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ êµ¬í˜„í•˜ê³ , Transaction ê²½ê³„ ì„¤ì •ê³¼ ë™ê¸°í™”í•˜ëŠ” ë¶€ë¶„ì„ êµ¬í˜„í•´ ë³´ëŠ” ë¯¸ì…˜ì´ì—ˆë‹¤.  
ë¯¸ì…˜ ëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.  

- JDBC ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ êµ¬í˜„í•˜ë©´ì„œ ì¤‘ë³µì„ ì œê±°í•˜ëŠ” ì—°ìŠµì„ í•œë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì´í•´ë„ë¥¼ ë†’ì¸ë‹¤.

ìµœëŒ€í•œ Javaê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬íŒ©í„°ë§ í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.  

### JdbcTemplate

JdbcTemplateì€ Connectionì„ ì´ìš©í•˜ì—¬ PreparedStatementë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„, ê·¸ë¦¬ê³  PreparedStatementê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ì— ëŒ€í•œ ë¶€ë¶„ì„ ë¶„ë¦¬í–ˆë‹¤.  
í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì ì ˆí•˜ê²Œ ì ìš©í•˜ì—¬ ì¤‘ë³µì„ ë¹„êµì  ê°„ë‹¨í•˜ê²Œ ì œê±°í•  ìˆ˜ ìˆì—ˆë‹¤.  
ì˜ˆì „ì—ë„ ë¯¸ì…˜ì„ ì§„í–‰í•˜ë©´ì„œ [JdbcTemplateì„ êµ¬í˜„](./custom-jdbc-template)í•œ ì ì´ ìˆì—ˆëŠ”ë°, ì´ë²ˆì—ëŠ” ìì› í• ë‹¹ê³¼ í•´ì œ ë¶€ë¶„ì— ëŒ€í•œ ì¤‘ë³µë„ ì œê±°í–ˆë‹¤.  

```java
public class JdbcTemplate {

    private static final Logger log = LoggerFactory.getLogger(JdbcTemplate.class);

    private final DataSource dataSource;
    private final StatementCreator statementCreator;
    private final StatementExecutor statementExecutor;

    public JdbcTemplate(final DataSource dataSource) {
        this(dataSource, new StatementCreator(), new StatementExecutor());
    }

    JdbcTemplate(
            final DataSource dataSource,
            final StatementCreator statementCreator,
            final StatementExecutor statementExecutor
    ) {
        this.dataSource = dataSource;
        this.statementCreator = statementCreator;
        this.statementExecutor = statementExecutor;
    }

    private <T> T query(
            final String sql,
            final PreparedStatementCallback<T> preparedStatementCallback,
            final Object... parameters
    ) {
        final Connection connection = DataSourceUtils.getConnection(dataSource);
        try (final PreparedStatement preparedStatement = statementCreator.create(connection, sql, parameters)) {
            return preparedStatementCallback.execute(preparedStatement);
        } catch (final SQLException e) {
            log.error(e.getMessage(), e);
            throw new DataAccessException(e);
        } finally {
            DataSourceUtils.releaseConnection(connection, dataSource);
        }
    }

    public void update(final String sql, final Object... parameters) {
        query(sql, PreparedStatement::executeUpdate, parameters);
    }

    public <T> Optional<T> queryForObject(final String sql, final RowMapper<T> rowMapper, final Object... parameters) {
        final List<T> results = query(sql, statement -> statementExecutor.execute(statement, rowMapper), parameters);
        if (results.size() > 1) {
            throw new DataAccessException("2ê°œ ì´ìƒì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        return results.stream().findAny();
    }

    public <T> List<T> queryForList(final String sql, final RowMapper<T> rowMapper, final Object... parameters) {
        return query(sql, statement -> statementExecutor.execute(statement, rowMapper), parameters);
    }
}
```

### íŠ¸ëœì­ì…˜ ì ìš©

3, 4ë‹¨ê³„ëŠ” ê¸°ì¡´ì˜ ì½”ë“œì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ëë‚˜ëŠ” ë¶€ë¶„ì¸ íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ ì„¤ì •í•˜ê³  ThreadLocalì„ ì´ìš©í•˜ì—¬ íŠ¸ëœì­ì…˜ ë™ê¸°í™”(Transaction synchronization)ë¥¼ ì ìš©í•˜ëŠ” ë¯¸ì…˜ì´ì—ˆë‹¤.  
íŠ¸ëœì­ì…˜ ë™ê¸°í™”ë€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê¸° ìœ„í•œ Connection ê°ì²´ë¥¼ ThreadLocalê³¼ ê°™ì€ ê³µê°„ì— ë”°ë¡œ ì €ì¥ í›„, í•„ìš”í•  ë•Œ ì €ì¥ëœ Connectionì„ ê°€ì ¸ë‹¤ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤.  
ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¡œ ë¯¸ì…˜ì„ ì§„í–‰í–ˆëŠ”ë°, ThreadLocalì— Connection ê°ì²´ê°€ ì•„ë‹Œ, Connection ê°ì²´ì™€ Transactionì´ ì§„í–‰ ì¤‘ì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” flagë¥¼ ê°€ì§€ê³  ìˆëŠ” í´ë˜ìŠ¤ë¥¼ ì €ì¥í•´ì„œ ì‚¬ìš©í•˜ë„ë¡ í–ˆë‹¤.  

```mermaid
graph LR
	TransactionTemplate --> TransactionManager
	TransactionManager --> TransactionSynchronizationManager
	DataSourceUtils --> TransactionSynchronizationManager
	JdbcTemplate --> DataSourceUtils
```

### ë§ˆë¬´ë¦¬

Jdbc ë¯¸ì…˜ì„ ì§„í–‰í•˜ë©´ì„œ AOPë‚˜ Transactionalì— ëŒ€í•œ í•™ìŠµ í…ŒìŠ¤íŠ¸ë„ ì§„í–‰í•˜ê³ , ì•½ê°„ ì•Œì°¬ ë¯¸ì…˜ì´ì—ˆë˜ ê²ƒ ê°™ë‹¤.  
ê¼¼ê¼¼íˆ ì½”ë“œë¥¼ ë´ì¤€ ë¦¬ë·°ì–´ í˜¸ì´ ê·¸ë¦¬ê³  ì—°íœ´ ë™ì•ˆ ê³„ì† í‹°í‚¤íƒ€ì¹´ í•˜ë©´ì„œ ì¬ë°Œê²Œ ë¦¬ë·°í•œ ë¯¼íŠ¸ì—ê²Œ ê°ì‚¬í•˜ë‹¤.  
íšŒê³  ì´ë§Œ ëë‚´ê³  ë¦¬íŒ©í„°ë§ ë¯¸ì…˜ í•˜ëŸ¬ê°€ì•¼ê² ë‹¤. ğŸ˜Š 