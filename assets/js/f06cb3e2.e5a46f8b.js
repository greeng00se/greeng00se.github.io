"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2620],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var u=n.createContext({}),c=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(u.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=c(a),d=r,S=m["".concat(u,".").concat(d)]||m[d]||s[d]||l;return a?n.createElement(S,o(o({ref:t},p),{},{components:a})):n.createElement(S,o({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,o=new Array(l);o[0]=m;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var c=2;c<l;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},85162:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(86010);const l="tabItem_Ymn6";function o(e){let{children:t,hidden:a,className:o}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,o),hidden:a},t)}},74866:(e,t,a)=>{a.d(t,{Z:()=>v});var n=a(87462),r=a(67294),l=a(86010),o=a(12466),i=a(16550),u=a(91980),c=a(67392),p=a(50012);function s(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function m(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??s(a);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function d(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function S(e){let{queryString:t=!1,groupId:a}=e;const n=(0,i.k6)(),l=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,u._X)(l),(0,r.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(n.location.search);t.set(l,e),n.replace({...n.location,search:t.toString()})}),[l,n])]}function k(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,l=m(e),[o,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:l}))),[u,c]=S({queryString:a,groupId:n}),[s,k]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,l]=(0,p.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&l.set(e)}),[a,l])]}({groupId:n}),g=(()=>{const e=u??s;return d({value:e,tabValues:l})?e:null})();(0,r.useEffect)((()=>{g&&i(g)}),[g]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!d({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),k(e)}),[c,k,l]),tabValues:l}}var g=a(72389);const b="tabList__CuJ",y="tabItem_LNqP";function _(e){let{className:t,block:a,selectedValue:i,selectValue:u,tabValues:c}=e;const p=[],{blockElementScrollPositionUntilNextRender:s}=(0,o.o5)(),m=e=>{const t=e.currentTarget,a=p.indexOf(t),n=c[a].value;n!==i&&(s(t),u(n))},d=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const a=p.indexOf(e.currentTarget)+1;t=p[a]??p[0];break}case"ArrowLeft":{const a=p.indexOf(e.currentTarget)-1;t=p[a]??p[p.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},t)},c.map((e=>{let{value:t,label:a,attributes:o}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>p.push(e),onKeyDown:d,onClick:m},o,{className:(0,l.Z)("tabs__item",y,o?.className,{"tabs__item--active":i===t})}),a??t)})))}function N(e){let{lazy:t,children:a,selectedValue:n}=e;if(t){const e=a.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function R(e){const t=k(e);return r.createElement("div",{className:(0,l.Z)("tabs-container",b)},r.createElement(_,(0,n.Z)({},e,t)),r.createElement(N,(0,n.Z)({},e,t)))}function v(e){const t=(0,g.Z)();return r.createElement(R,(0,n.Z)({key:String(t)},e))}},7729:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>s});var n=a(87462),r=(a(67294),a(3905)),l=a(74866),o=a(85162);const i={title:"DB \ubcf5\uc81c, @Transactional\uc5d0 \ub530\ub77c \uc694\uccad \ubd84\ub9ac\ud574\ubcf4\uae30",slug:"db-replication",tags:["mysql","replication"]},u=void 0,c={permalink:"/db-replication",editUrl:"https://github.com/greeng00se/greeng00se.github.io/tree/main/blog/2023-3/2023-08-22-DB \ubcf5\uc81c, @Transactional\uc5d0 \ub530\ub77c \uc694\uccad \ubd84\ub9ac\ud574\ubcf4\uae30.mdx",source:"@site/blog/2023-3/2023-08-22-DB \ubcf5\uc81c, @Transactional\uc5d0 \ub530\ub77c \uc694\uccad \ubd84\ub9ac\ud574\ubcf4\uae30.mdx",title:"DB \ubcf5\uc81c, @Transactional\uc5d0 \ub530\ub77c \uc694\uccad \ubd84\ub9ac\ud574\ubcf4\uae30",description:"\ubcf5\uc81c(Replication)",date:"2023-08-22T00:00:00.000Z",formattedDate:"2023\ub144 8\uc6d4 22\uc77c",tags:[{label:"mysql",permalink:"/tags/mysql"},{label:"replication",permalink:"/tags/replication"}],readingTime:20.58,hasTruncateMarker:!1,authors:[],frontMatter:{title:"DB \ubcf5\uc81c, @Transactional\uc5d0 \ub530\ub77c \uc694\uccad \ubd84\ub9ac\ud574\ubcf4\uae30",slug:"db-replication",tags:["mysql","replication"]},prevItem:{title:"\uc131\ub2a5 \ud14c\uc2a4\ud2b8 \uc885\ub958",permalink:"/performance-test-type"},nextItem:{title:"\uc6b0\uc544\ud55c\ud14c\ud06c\ucf54\uc2a4 \ub808\ubca8 3 \ud68c\uace0",permalink:"/woowacourse-level3-retrospective"}},p={authorsImageUrls:[]},s=[{value:"\ubcf5\uc81c(Replication)",id:"\ubcf5\uc81creplication",level:2},{value:"\ubcf5\uc81c\ub97c \ud558\ub294 \uc774\uc720",id:"\ubcf5\uc81c\ub97c-\ud558\ub294-\uc774\uc720",level:3},{value:"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ud30c\uc77c \uc704\uce58 \uae30\ubc18 \ubcf5\uc81c",id:"\ubc14\uc774\ub108\ub9ac-\ub85c\uadf8-\ud30c\uc77c-\uc704\uce58-\uae30\ubc18-\ubcf5\uc81c",level:3},{value:"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ubc29\uc2dd\uc758 \ubb38\uc81c\uc810",id:"\ubc14\uc774\ub108\ub9ac-\ub85c\uadf8-\ubc29\uc2dd\uc758-\ubb38\uc81c\uc810",level:3},{value:"\uae00\ub85c\ubc8c \ud2b8\ub79c\uc7ad\uc158 \uc544\uc774\ub514(GTID) \uae30\ubc18 \ubcf5\uc81c",id:"\uae00\ub85c\ubc8c-\ud2b8\ub79c\uc7ad\uc158-\uc544\uc774\ub514gtid-\uae30\ubc18-\ubcf5\uc81c",level:3},{value:"\ubcf5\uc81c \ud1a0\ud3f4\ub85c\uc9c0",id:"\ubcf5\uc81c-\ud1a0\ud3f4\ub85c\uc9c0",level:3},{value:"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ubc29\uc2dd Replication \uad6c\uc131\ud558\uae30",id:"\ubc14\uc774\ub108\ub9ac-\ub85c\uadf8-\ubc29\uc2dd-replication-\uad6c\uc131\ud558\uae30",level:2},{value:"MySQL \ud658\uacbd \uad6c\uc131",id:"mysql-\ud658\uacbd-\uad6c\uc131",level:3},{value:"\ub3c4\ucee4 \uc2e4\ud589",id:"\ub3c4\ucee4-\uc2e4\ud589",level:3},{value:"replication slave \uad8c\ud55c \uc124\uc815",id:"replication-slave-\uad8c\ud55c-\uc124\uc815",level:3},{value:"SOURCE DB \uc815\ubcf4 \ud655\uc778",id:"source-db-\uc815\ubcf4-\ud655\uc778",level:3},{value:"SOURCE ip \uc8fc\uc18c \ud655\uc778",id:"source-ip-\uc8fc\uc18c-\ud655\uc778",level:3},{value:"replica mysql \uc811\uc18d",id:"replica-mysql-\uc811\uc18d",level:3},{value:"replica \uc124\uc815",id:"replica-\uc124\uc815",level:3},{value:"\uc124\uc815 \ud655\uc778",id:"\uc124\uc815-\ud655\uc778",level:3},{value:"\uc2a4\ud504\ub9c1 \ubd80\ud2b8\ub85c DB \uc811\uadfc\ud558\uae30",id:"\uc2a4\ud504\ub9c1-\ubd80\ud2b8\ub85c-db-\uc811\uadfc\ud558\uae30",level:2},{value:"Environment \uc124\uc815",id:"environment-\uc124\uc815",level:3},{value:"DataSourceType \uc124\uc815",id:"datasourcetype-\uc124\uc815",level:3},{value:"AbstractRoutingDataSource \uc124\uc815",id:"abstractroutingdatasource-\uc124\uc815",level:3},{value:"DataSource \uc124\uc815",id:"datasource-\uc124\uc815",level:3},{value:"\ub3d9\uc791 \ud655\uc778",id:"\ub3d9\uc791-\ud655\uc778",level:3},{value:"\ucc38\uace0 \uc790\ub8cc",id:"\ucc38\uace0-\uc790\ub8cc",level:2}],m={toc:s};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\ubcf5\uc81creplication"},"\ubcf5\uc81c(Replication)"),(0,r.kt)("p",null,"\ud55c \uc11c\ubc84\uc5d0\uc11c \ub2e4\ub978 \uc11c\ubc84\ub85c \ub370\uc774\ud130\ub97c \ub3d9\uae30\ud654\ud558\ub294 \uac83\uc744 \uc758\ubbf8\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc6d0\ubcf8 \ub370\uc774\ud130\ub97c \uac00\uc9c0\ub294 \uc11c\ubc84\ub97c Primary \ub610\ub294 Source \ub77c\uace0 \ubd80\ub974\uace0, \ubcf5\uc81c\ub41c \ub370\uc774\ud130\ub97c \uac00\uc9c0\ub294 \uc11c\ubc84\ub97c Secondary \ub610\ub294 Replica \ub77c\uace0 \ubd80\ub978\ub2e4.  "),(0,r.kt)("h3",{id:"\ubcf5\uc81c\ub97c-\ud558\ub294-\uc774\uc720"},"\ubcf5\uc81c\ub97c \ud558\ub294 \uc774\uc720"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. \uc2a4\ucf00\uc77c \uc544\uc6c3")),(0,r.kt)("p",null,"\uc0ac\uc6a9\uc790\uc758 \ud2b8\ub798\ud53d\uc774 \uc99d\uac00\ud558\ub294 \uacbd\uc6b0, \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \uac00\ud574\uc9c0\ub294 \ubd80\ud558\ub3c4 \uc790\uc5f0\uc2a4\ub7fd\uac8c \uc99d\uac00\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc774\ub97c \ucc98\ub9ac\ud558\uae30 \uc704\ud574 \ubcf5\uc81c\ub97c \ud1b5\ud55c \uc2a4\ucf00\uc77c \uc544\uc6c3\uc744 \uc801\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ucffc\ub9ac\ub4e4\uc744 \uac01\uac01\uc758 \ub370\uc774\ud130\ubca0\uc774\uc2a4\ub85c \ubd84\uc0b0 \uc2dc\ud0ac \uc218 \uc788\ub2e4.  "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. \ub370\uc774\ud130 \ubc31\uc5c5")),(0,r.kt)("p",null,"\uc2e4\uc81c \uc6b4\uc601\ub418\ub294 \uc11c\ube44\uc2a4\uac00 \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 DB\uc5d0\uc11c \ubc31\uc5c5\uc744 \uc9c4\ud589\ud558\ub294 \uacbd\uc6b0, \uc11c\ube44\uc2a4\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub530\ub77c\uc11c \uc2e4\uc81c \uc11c\ube44\uc2a4\uc5d0 \uc601\ud5a5\uc774 \uac00\uc9c0 \uc54a\ub3c4\ub85d \ubcf5\uc81c\ub97c \ud1b5\ud574 Replica \uc11c\ubc84\ub97c \uad6c\ucd95\ud558\uc5ec, Replica \uc11c\ubc84\uc5d0\uc11c \ubcf5\uc81c\ub97c \uc9c4\ud589\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \uc601\ud5a5\uc744 \ucd5c\uc18c\ud654 \ud560 \uc218 \uc788\ub2e4.  "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. \ub370\uc774\ud130 \ubd84\uc11d")),(0,r.kt)("p",null,"\ubc31\uc5c5\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \ubcf5\uc7a1\ud558\uace0 \ubb34\uac70\uc6b4 \ubd84\uc11d\uc6a9 \ucffc\ub9ac\uc758 \uc11c\ube44\uc2a4\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub9c8\ucc2c\uac00\uc9c0\ub85c \ubcf5\uc81c\ub97c \uc0ac\uc6a9\ud574 \ubd84\uc11d\uc6a9 \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud658\uacbd\uc744 \ub9cc\ub4e4 \uc218 \uc788\ub2e4.  "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4. \ub370\uc774\ud130\uc758 \uc9c0\ub9ac\uc801 \ubd84\uc0b0")),(0,r.kt)("p",null,"\ube60\ub978 \uc751\ub2f5\uc744 \uc704\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc11c\ubc84\uc5d0 \uac00\uae5d\uac8c \uc11c\ubc84\ub97c \uad6c\uc131\ud558\uac70\ub098, \uace0\uac00\uc6a9\uc131(High Availability)\uc744 \uc704\ud574\uc11c\ub3c4 \uc0ac\uc6a9\ub41c\ub2e4.  "),(0,r.kt)("h3",{id:"\ubc14\uc774\ub108\ub9ac-\ub85c\uadf8-\ud30c\uc77c-\uc704\uce58-\uae30\ubc18-\ubcf5\uc81c"},"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ud30c\uc77c \uc704\uce58 \uae30\ubc18 \ubcf5\uc81c"),(0,r.kt)("p",null,"MySQL \uc11c\ubc84\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \ubcc0\uacbd\uc0ac\ud56d\uc5d0 \ub300\ud55c \ub85c\uadf8 \ud30c\uc77c\uc744 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8\ub77c\uace0 \ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ubc14\uc774\ub108\ub9ac \ub85c\uadf8\ub97c \ud1b5\ud574 \ub370\uc774\ud130 \ubcc0\uacbd, \ud14c\uc774\ube14 \uad6c\uc870 \ubcc0\uacbd, \uacc4\uc815\uc774\ub098 \uad8c\ud55c \ubcc0\uacbd\uc5d0 \ub300\ud55c \uc815\ubcf4\uac00 \uc800\uc7a5\ub41c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","MySQL\uc758 \ubcf5\uc81c\ub294 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \uae30\ubc18\uc73c\ub85c \uad6c\ud604\ub418\uc5b4 \uc788\ub2e4. \uc774\ub97c Replica \uc11c\ubc84\ub85c \uc804\ub2ec\ud558\uace0 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \uae30\ubc18\uc73c\ub85c \ub370\uc774\ud130\ub97c \ubcc0\uacbd \uc0ac\ud56d\uc744 \ubc18\uc601\ud55c\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n\tsubgraph Replica\n\t\tdirection TB\n\t\tIO[Replication I/O thread] -- save --\x3e RL[Relay Log]\n\t\tSQL[Replication SQL Thread] -- read --\x3e RL\n\tend\n\n\tsubgraph Source\n\t\tdirection TB\n\t\tBLD[Binary Log Dump Thread] -- Send Binary Log Dump--\x3e IO\n\tend\n"}),(0,r.kt)("admonition",{title:"\uc2a4\ub808\ub4dc\ubcc4 \uc5ed\ud560",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Binary Log Dump Thread: \ubc14\uc774\ub108\ub9ac \ub85c\uadf8\uc758 \ub0b4\uc6a9\uc744 Replica \uc11c\ubc84\ub85c \uc804\ub2ec",(0,r.kt)("br",{parentName:"p"}),"\n","Replication I/O Thread: Binary \ub85c\uadf8 \uc774\ubca4\ud2b8\ub97c \uac00\uc838\uc640 \ub85c\uceec \uc11c\ubc84\uc758 \ud30c\uc77c(Relay Log)\ub85c \uc800\uc7a5",(0,r.kt)("br",{parentName:"p"}),"\n","Replication SQL Thread: \ub9b4\ub808\uc774 \ub85c\uadf8 \ud30c\uc77c\uc758 \uc774\ubca4\ud2b8\ub97c \uc77d\uace0 \uc2e4\ud589")),(0,r.kt)("h3",{id:"\ubc14\uc774\ub108\ub9ac-\ub85c\uadf8-\ubc29\uc2dd\uc758-\ubb38\uc81c\uc810"},"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ubc29\uc2dd\uc758 \ubb38\uc81c\uc810"),(0,r.kt)("p",null,"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ubc29\uc2dd\uc740 \uc11c\ubc84\uc5d0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud588\uc744 \ub54c \ubcf5\uc81c \ud1a0\ud3f4\ub85c\uc9c0 \ubcc0\uacbd\uc774 \uae4c\ub2e4\ub86d\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ud1a0\ud3f4\ub85c\uc9c0\ub780 \ub124\ud2b8\uc6cc\ud06c\uc758 \uc694\uc18c\ub4e4\uc744 \ubb3c\ub9ac\uc801\uc73c\ub85c \uc5f0\uacb0\ud574 \ub193\uc740 \uac83, \ub610\ub294 \uadf8 \uc5f0\uacb0 \ubc29\uc2dd\uc744 \ub9d0\ud55c\ub2e4."),(0,r.kt)("mermaid",{value:"graph TD\n\tA[A binary-log:300] --\x3e B[B Binary-log:300]\n\tA[A binary-log:300] --\x3e C[C Binary-log:200]"}),(0,r.kt)("p",null,"\uc704\uc640 \uac19\uc774 Source \uc11c\ubc84, Replica 2\ub300\uac00 \uc874\uc7ac\ud558\uace0, C \uc11c\ubc84\uc5d0 \ubcf5\uc81c \uc9c0\uc5f0\uc774 \ub418\uc5c8\uc744 \ub54c \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud55c\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph TD\n\tA[A binary-log:300]\n\tB[B Binary-log:300] --\x3e C[C Binary-log:200 \ubb38\uc81c \ubc1c\uc0dd]"}),(0,r.kt)("p",null,"A \uc11c\ubc84\uc5d0\uc11c \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud55c\ub2e4\uba74 B \uc11c\ubc84\ub97c Source \uc11c\ubc84\ub85c \uc2b9\uaca9\ud558\uace0, C\uc5d0\uac8c \uc870\ud68c \ucffc\ub9ac\ub97c \ubd84\uc0b0\uc2dc\ud0a8\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ud558\uc9c0\ub9cc \uc5ec\uae30\uc11c C \uc11c\ubc84\uc5d0\ub294 A \uc11c\ubc84\uc640 \ub3d9\uae30\ud654\uac00 \uc548\ub418\uc5c8\uc73c\ub2c8 \uc870\ud68c \uc2dc \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub4a4\ub2a6\uac8c B \uc11c\ubc84\uc640 \ub3d9\uae30\ud654\ub97c \ud558\ub824\uace0 \ud574\ub3c4, \uc5b4\ub5a4 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8, \uc5b4\ub5a4 \uc704\uce58\uc640 \ub3d9\uae30\ud654\ud574\uc57c\ud558\ub294\uc9c0 \uc54c\uae30 \uc5b4\ub835\ub2e4.   "),(0,r.kt)("h3",{id:"\uae00\ub85c\ubc8c-\ud2b8\ub79c\uc7ad\uc158-\uc544\uc774\ub514gtid-\uae30\ubc18-\ubcf5\uc81c"},"\uae00\ub85c\ubc8c \ud2b8\ub79c\uc7ad\uc158 \uc544\uc774\ub514(GTID) \uae30\ubc18 \ubcf5\uc81c"),(0,r.kt)("p",null,"GTID \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucc38\uc5ec\ud55c \ubaa8\ub4e0 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uac00 \ubc1c\uc0dd\ud55c \uc774\ubca4\ud2b8\uc5d0 \uace0\uc720\ud55c \uc2dd\ubcc4\uac12\uc744 \ubd80\uc5ec\ud55c\ub2e4\uba74, \ub3d9\uae30\ud654\uc5d0 \ub300\ud55c \ubb38\uc81c\ub97c \uac04\ub2e8\ud558\uac8c \ud574\uacb0\ud560 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc704\uc758 \uc608\uc2dc\uc640 \uac19\uc774 \ubcf5\uc81c \uc9c0\uc5f0\uacfc \ud568\uaed8 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud55c\ub2e4\ud574\ub3c4 \ud2b9\uc815 GTID \ubd80\ud130 \ubcf5\uc81c\ub97c \uc7ac\uac1c\ud558\uba74 \ub41c\ub2e4.  "),(0,r.kt)("admonition",{title:"GTID",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\ubcf5\uc81c \ud1a0\ud3f4\ub85c\uc9c0\uc5d0 \ucc38\uc5ec\ud55c \ubaa8\ub4e0 \uc11c\ubc84\uc5d0\uc11c \uace0\uc720\ud558\ub3c4\ub85d \uac01 \uc774\ubca4\ud2b8\uc5d0 \ubd80\uc5ec\ub41c \uc2dd\ubcc4\uac12",(0,r.kt)("br",{parentName:"p"}),"\n","[source_id]",":","[transaction_id]","\ub85c \uad6c\uc131\ub418\uba70, source_id\ub294 \uc11c\ubc84\ub97c \uc2dd\ubcc4\ud558\uae30 \uc704\ud55c \uac12\uc774\uace0 transaction_id\ub294 \ucee4\ubc0b\ub41c \ud2b8\ub79c\uc7ad\uc158\uc744 \uc2dd\ubcc4\ud558\uae30 \uc704\ud55c \uac12\uc73c\ub85c 1\uc529 \uc99d\uac00\ud558\ub294 \ud615\ud0dc\ub85c \ubc1c\uae09\ub41c\ub2e4.  ")),(0,r.kt)("h3",{id:"\ubcf5\uc81c-\ud1a0\ud3f4\ub85c\uc9c0"},"\ubcf5\uc81c \ud1a0\ud3f4\ub85c\uc9c0"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uc2f1\uae00 \ub808\ud50c\ub9ac\uce74 \ubcf5\uc81c \uad6c\uc131")),(0,r.kt)("p",null,"\uac00\uc7a5 \uac04\ub2e8\ud55c \uad6c\uc131\uc73c\ub85c \uc81c\uc77c \ub9ce\uc774 \uc0ac\uc6a9\ud558\ub294 \ud615\ud0dc\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","replica \uc11c\ubc84\ub97c \uc77d\uae30 \uc804\uc6a9, \uc608\ube44 \uc11c\ubc84, \ubc31\uc5c5 \uc6a9\ub3c4\ub85c \ub9ce\uc774 \uc0ac\uc6a9\ud55c\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n  W[Web Server] -- \uc77d\uae30 + \uc4f0\uae30 --\x3e S\n  W -- \uc77d\uae30 --\x3e R\n  S[Source] --\x3e R[Replica]"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uba40\ud2f0 \ub808\ud50c\ub9ac\uce74 \ubcf5\uc81c \uad6c\uc131")),(0,r.kt)("p",null,"2\uac1c\uc758 replica \uc11c\ubc84\ub97c \uc0ac\uc6a9\ud558\ub294 \ud615\ud0dc\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ud558\ub098\uc758 replica\ub294 \uc608\ube44 \uc6a9\ub3c4\ub85c \ub0a8\uaca8\ub450\ub294 \ud615\ud0dc\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ucd94\ud6c4\uc5d0 \ud2b8\ub798\ud53d\uc774 \uc99d\uac00\ud558\ub294 \uacbd\uc6b0 \uc608\ube44 \uc6a9\ub3c4\uc758 replica\ub97c \uc0ac\uc6a9\ud568\uc73c\ub85c \uc77d\uae30 \uc694\uccad\uc758 \ubd80\ud558 \ubd84\uc0b0\uc744 \ud560 \uc218 \uc788\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n  W[Web Server] -- \uc77d\uae30 + \uc4f0\uae30 --\x3e S\n  W -- \uc77d\uae30 --\x3e R1\n  S[Source] --\x3e R1[Replica1]\n  S --\x3e R2[Replica2]"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uccb4\uc778 \ubcf5\uc81c \uad6c\uc131")),(0,r.kt)("p",null,"replica \uc11c\ubc84\uac00 \ub9ce\uc740 \uacbd\uc6b0 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8\ub97c \uc804\ub2ec\ud558\ub294 \uc791\uc5c5 \uc790\uccb4\uac00 \ubd80\ud558\uac00 \ub420 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub530\ub77c\uc11c 1:M:M \uad6c\uc870\ub85c \uccb4\uc778 \ubcf5\uc81c \uad6c\uc131\uc744 \uace0\ub824\ud560 \uc218 \uc788\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n  W[Web Server] -- \uc77d\uae30 + \uc4f0\uae30 --\x3e S\n  W -- \uc77d\uae30 --\x3e R1\n  S[Source] --\x3e R1[Replica1]\n  S --\x3e R2[Replica2]\n  S --\x3e R3[Replica3]\n\n  R3 --\x3e R3-1[Replica 3-1]\n  R3 --\x3e R3-2[Replica 3-2]\n\n  B[Batch Server] --\x3e R3-2"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\ub4c0\uc5bc \uc18c\uc2a4 \ubcf5\uc81c \uad6c\uc131")),(0,r.kt)("p",null,"2\uac1c\uc758 MySQL \uc11c\ubc84 \ubaa8\ub450 \uc77d\uae30\uc640 \uc4f0\uae30\uac00 \uac00\ub2a5\ud558\ub3c4\ub85d \ud558\ub294 \uad6c\uc131\uc774\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uac01 \uc11c\ubc84\uc5d0\uc11c \ubcc0\uacbd\ub41c \ub370\uc774\ud130\ub294 \ub2e4\ub978 \uc11c\ubc84\uc5d0 \ubc18\uc601\ub41c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ubaa9\uc801\uc5d0 \ub530\ub77c ACTIVE-ACTIVE \ud615\ud0dc \ub610\ub294 ACTIVE-PASSIVE \ud615\ud0dc\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","ACTIVE-PASSIVE \ud615\ud0dc\uc778 \uacbd\uc6b0 \uc2f1\uae00 \ub808\ud50c\ub9ac\uce74 \ubcf5\uc81c \uad6c\uc131\uacfc \ub3d9\uc77c\ud574\ubcf4\uc774\uc9c0\ub9cc, ACTIVE \uc11c\ubc84\uc5d0\uc11c \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 \uc124\uc815\uc758 \ubcc0\uacbd\uc5c6\uc774 PASSIVE \uc11c\ubc84\ub85c \uc4f0\uae30 \uc791\uc5c5\uc744 \uc804\ud658\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc774 \uc7a5\uc810\uc774\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n  W[Web Server] -- \uc77d\uae30 + \uc4f0\uae30 --\x3e SR1\n  W -- \uc77d\uae30 + \uc4f0\uae30 --\x3e SR2\n  SR1[Source/Replica 1] --\x3e SR2[Source/Replica 2]"}),(0,r.kt)("admonition",{title:"ACTIVE-ACTIVE, ACTIVE-PASSIVE",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"ACTIVE-ACTIVE: 2\uac1c\uc758 \uc11c\ubc84 \ubaa8\ub450 \uc4f0\uae30 \uc791\uc5c5\uc744 \uc218\ud589\ud558\ub294 \ud615\ud0dc",(0,r.kt)("br",{parentName:"p"}),"\n","ACTIVE-PASSIVE: \ud558\ub098\uc758 \uc11c\ubc84\uc5d0\uc11c\ub9cc \uc4f0\uae30 \uc791\uc5c5\uc744 \uc218\ud589\ud558\ub294 \ud615\ud0dc")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uba40\ud2f0 \uc18c\uc2a4 \ubcf5\uc81c \uad6c\uc131")),(0,r.kt)("p",null,"\uc5ec\ub7ec\uac1c\uc758 source \uc11c\ubc84\uc640 \ud558\ub098\uc758 replica \uc11c\ubc84\ub97c \uc0ac\uc6a9\ud558\ub294 \uad6c\uc131\uc774\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc774\ub294 source \uc11c\ubc84\uc758 \ub370\uc774\ud130\ub97c \ud55c \uacf3\uc5d0 \ubc31\uc5c5\ud558\ub294 \uc6a9\ub3c4\ub85c \uc0ac\uc6a9, \uc5ec\ub7ec \uc11c\ubc84\uc5d0 \uc874\uc7ac\ud558\ub294 \ub370\uc774\ud130\ub97c \ud1b5\ud569, \uc0e4\ub529\ub418\uc5b4\uc788\ub294 \ud14c\uc774\ube14 \ub370\uc774\ud130\ub97c \ud1b5\ud569\ud560 \ub54c \uc0ac\uc6a9\ud55c\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n  S1[Source 1] --\x3e R[Replica]\n  S2[Source 2] --\x3e R"}),(0,r.kt)("h2",{id:"\ubc14\uc774\ub108\ub9ac-\ub85c\uadf8-\ubc29\uc2dd-replication-\uad6c\uc131\ud558\uae30"},"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ubc29\uc2dd Replication \uad6c\uc131\ud558\uae30"),(0,r.kt)("p",null,"mysql 2\ub300\ub97c \uc774\uc6a9\ud558\uc5ec replication\uc744 \uad6c\uc131\ud558\uace0, spring boot application\uc73c\ub85c source, replica \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \uc811\uadfc\ud574\ubcf4\ub294 \uc608\uc81c\uc774\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bbiac/db-replication"},"https://github.com/bbiac/db-replication"),"  "),(0,r.kt)("h3",{id:"mysql-\ud658\uacbd-\uad6c\uc131"},"MySQL \ud658\uacbd \uad6c\uc131"),(0,r.kt)("p",null,"MySQL \ubc84\uc804\uc740 8.1\uc744 \uc0ac\uc6a9\ud588\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","13306, 13307 \ud3ec\ud2b8\ub97c \uc0ac\uc6a9\ud574\uc11c MySQL \uc11c\ubc84 2\ub300\ub97c \ub744\uc6e0\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub610\ud55c \uc0ac\uc2e4 IP \ub300\uc5ed\uc73c\ub85c \ud1b5\uc2e0\ud560 \uc218 \uc788\ub3c4\ub85d \ucee4\uc2a4\ud140 \ub124\ud2b8\uc6cc\ud06c\ub97c \ucd94\uac00\ud588\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: '3.8'\n\nservices:\n  source:\n    platform: linux/x86_64\n    image: mysql:latest\n    restart: always\n    container_name: mysql-source\n    environment:\n      TZ: 'Asia/Seoul'\n      MYSQL_DATABASE: 'db'\n      MYSQL_USER: 'user'\n      MYSQL_PASSWORD: 'password'\n      MYSQL_ROOT_PASSWORD: 'password'\n    ports:\n      - \"13306:3306\"\n    volumes:\n      - db-source:/var/lib/mysql\n      - db-source:/var/lib/mysql-files\n      - ./docker/source.cnf:/etc/mysql/my.cnf\n    networks:\n      - mysql_network\n\n  replica:\n    platform: linux/x86_64\n    image: mysql:latest\n    restart: always\n    container_name: mysql-replica\n    environment:\n      TZ: 'Asia/Seoul'\n      MYSQL_DATABASE: 'db'\n      MYSQL_USER: 'user'\n      MYSQL_PASSWORD: 'password'\n      MYSQL_ROOT_PASSWORD: 'password'\n    ports:\n      - \"13307:3306\"\n    volumes:\n      - db-replica:/var/lib/mysql\n      - db-replica:/var/lib/mysql-files\n      - ./docker/replica.cnf:/etc/mysql/my.cnf\n    networks:\n      - mysql_network\n\nvolumes:\n  db-source:\n  db-replica:\n\nnetworks:\n  mysql_network:\n    driver: bridge\n")),(0,r.kt)("p",null,"\ub610\ud55c source, replica \uac01\uac01 \ub2e4\uc74c\uacfc \uac19\uc774 db \uc124\uc815\uc744 \ud588\ub2e4.  "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\uc124\uc815"),(0,r.kt)("th",{parentName:"tr",align:null},"\uc124\uba85"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"server_id"),(0,r.kt)("td",{parentName:"tr",align:null},"\uac01\uac01\uc758 mysql \ub9c8\ub2e4 \uace0\uc720\ud55c \uac12\uc744 \uac00\uc838\uc57c \ud55c\ub2e4.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"log_bin"),(0,r.kt)("td",{parentName:"tr",align:null},"\ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ud30c\uc77c \uacbd\ub85c \uc124\uc815\uc73c\ub85c \uc808\ub300\uacbd\ub85c\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 /var/lib/mysql \uc544\ub798 \ud574\ub2f9 log_bin\uc5d0 \uc124\uc815\ub41c \uac12\uc73c\ub85c \ub85c\uadf8\uac00 \uc0dd\uc131\ub41c\ub2e4.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sync_binlog"),(0,r.kt)("td",{parentName:"tr",align:null},"N\uac1c\uc758 \ud2b8\ub79c\uc7ad\uc158 \ub2f9 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8\ub97c \ub514\uc2a4\ud06c\uc640 \ub3d9\uae30\ud654 \uc791\uc5c5\uc744 \ud558\ub3c4\ub85d \ud55c\ub2e4.\xa01\uc740 \uae30\ubcf8\uac12\uc73c\ub85c \uc548\uc815\uc801\uc774\uc9c0\ub9cc, \uac00\uc7a5 \ub290\ub9ac\ub2e4.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"relay_log"),(0,r.kt)("td",{parentName:"tr",align:null},"\ub9b4\ub808\uc774 \ub85c\uadf8 \ud30c\uc77c \uacbd\ub85c \uc124\uc815")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"relay_log_purge"),(0,r.kt)("td",{parentName:"tr",align:null},"\ud544\uc694 \uc5c6\ub294 \ub9b4\ub808\uc774 \ub85c\uadf8 \ud30c\uc77c\uc744 \uc790\ub3d9\uc73c\ub85c \uc0ad\uc81c\ud558\ub294 \uc635\uc158")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"read_only"),(0,r.kt)("td",{parentName:"tr",align:null},"\uc77d\uae30 \uc804\uc6a9 \uc124\uc815")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"log_replica_updates"),(0,r.kt)("td",{parentName:"tr",align:null},"Replication SQL Thread\ub85c \uc778\ud574 \uc2e4\ud589\ub418\ub294 \uc815\ubcf4\ub97c \ubc14\uc774\ub108\ub9ac \ub85c\uadf8\uc5d0 \uae30\ub85d  \ucd94\ud6c4\uc5d0 \uc18c\uc2a4 \uc11c\ubc84\ub85c \uc2b9\uaca9\ub418\ub294 \uacbd\uc6b0\ub97c \uace0\ub824\ud558\uba74 \uc124\uc815\ud558\ub294 \uac83\uc774 \uc88b\ub2e4.")))),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Source",label:"Source",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cnf",metastring:'title="/docker/source.cnf"',title:'"/docker/source.cnf"'},"[mysqld]\nserver_id=1\nlog_bin=mysql-bin\nsync_binlog=1\n"))),(0,r.kt)(o.Z,{value:"Replica",label:"Replica",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cnf",metastring:'title="/docker/replica.cnf"',title:'"/docker/replica.cnf"'},"[mysqld]\nserver_id=2\nrelay_log=mysql-relay-bin\nrelay_log_purge=ON\nread_only\nlog_replica_updates\n")))),(0,r.kt)("h3",{id:"\ub3c4\ucee4-\uc2e4\ud589"},"\ub3c4\ucee4 \uc2e4\ud589"),(0,r.kt)("p",null,"docker-compose up \uba85\ub839\uc5b4\ub85c docker-compose \uc124\uc815\uc73c\ub85c docker\ub97c \ub744\uc6b4\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","-d \uc635\uc158\uc744 \ubd99\uc774\uba74 \ubc31\uadf8\ub77c\uc6b4\ub4dc \ubaa8\ub4dc\ub85c \uc2e4\ud589\ub41c\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker-compose up -d\n")),(0,r.kt)("h3",{id:"replication-slave-\uad8c\ud55c-\uc124\uc815"},"replication slave \uad8c\ud55c \uc124\uc815"),(0,r.kt)("p",null,"REPLICATION SLAVE \uad8c\ud55c\uc774 \uc124\uc815\ub418\uc5b4 \uc788\uc5b4\uc57c replica \uc11c\ubc84\uc5d0\uc11c source \uc11c\ubc84\uc5d0 \uc811\uadfc\ud558\uc5ec \ub85c\uadf8\ub97c \uc77d\uc5b4\uc62c \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","source \uc11c\ubc84\uc5d0 \uc811\uadfc\ud558\uc5ec user \uacc4\uc815\uc5d0 \ud574\ub2f9 \uad8c\ud55c\uc744 \uc124\uc815\ud574\uc900\ub2e4.  "),(0,r.kt)("p",null,"SOURCE \uc811\uc18d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it mysql-source mysql -u root -p\n")),(0,r.kt)("p",null,"user \uacc4\uc815\uc5d0 REPLICATION SLAVE \uad8c\ud55c \ucd94\uac00"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-mysql"},"GRANT REPLICATION SLAVE ON *.* TO 'user'@'%';\nFLUSH PRIVILEGES;\n")),(0,r.kt)("h3",{id:"source-db-\uc815\ubcf4-\ud655\uc778"},"SOURCE DB \uc815\ubcf4 \ud655\uc778"),(0,r.kt)("p",null,"replica \uc124\uc815\uc5d0 \ud544\uc694\ud55c source db\uc758 \ubc14\uc774\ub108\ub9ac \ub85c\uadf8 \ud30c\uc77c\uba85\uacfc Position\uc744 \ud655\uc778\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","Position \uac12\uc740 \uc2e4\uc81c \ud30c\uc77c\uc758 \ubc14\uc774\ud2b8 \uc218\ub97c \uc758\ubbf8\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ud655\uc778\ud55c File(SOURCE_LOG_FILE)\uacfc Position(SOURCE_LOG_POS) \uac12\uc740 replica \uc124\uc815\uc5d0\uc11c \uc0ac\uc6a9\ud55c\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-mysql"},"SHOW MASTER STATUS;\n\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000003 |     1082 |              |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n")),(0,r.kt)("h3",{id:"source-ip-\uc8fc\uc18c-\ud655\uc778"},"SOURCE ip \uc8fc\uc18c \ud655\uc778"),(0,r.kt)("p",null,"docker inspect -f \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 \ud574\ub2f9 \ucee8\ud14c\uc774\ub108\uc758 \uc138\ubd80 \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub2e4\uc74c \uba85\ub839\uc5b4\ub97c \uc774\uc6a9\ud574 docker-compose \ud30c\uc77c\uc5d0 \uc124\uc815\ud574\ub454 mysql_network\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 \uc0ac\uc124 \uc544\uc774\ud53c \uc8fc\uc18c\ub97c \ud655\uc778\ud55c\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker inspect -f "{{with index .NetworkSettings.Networks \\"db-replication_mysql_network\\"}}{{.IPAddress}}{{end}}" mysql-source\n')),(0,r.kt)("p",null,"ip \uc8fc\uc18c\uac00 \ub098\uc624\uc9c0 \uc54a\ub294 \uacbd\uc6b0 docker inspect mysql-source\ub85c \ud655\uc778\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ud655\uc778\ud55c IP\uc8fc\uc18c(SOURCE_HOST) \uac12\uc740 replica \uc124\uc815\uc5d0\uc11c \uc0ac\uc6a9\ud55c\ub2e4."),(0,r.kt)("h3",{id:"replica-mysql-\uc811\uc18d"},"replica mysql \uc811\uc18d"),(0,r.kt)("p",null,"source db\uc5d0 \uc811\uc18d\ud588\ub358 \ubc29\ubc95\uacfc \ub3d9\uc77c\ud558\uac8c replica db\uc5d0 \uc811\uc18d\ud55c\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it mysql-replica mysql -u root -p\n")),(0,r.kt)("h3",{id:"replica-\uc124\uc815"},"replica \uc124\uc815"),(0,r.kt)("p",null,"\uc774\uc804\uc5d0 source db\uc5d0\uc11c \uc5bb\uc5c8\ub358 \uc815\ubcf4\ub4e4\uc744 \uc0ac\uc6a9\ud558\uc5ec replica \uc124\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc2e4\uc81c DB \uc11c\ubc84\uc5d0\uc11c \ubcf5\uc81c\ud558\ub294 \uacbd\uc6b0 \ucd94\uac00\uc801\uc73c\ub85c source DB\uc758 \ud30c\uc77c\uc744 \ubcf5\uc81c\ud574\uc57c\ud558\uc9c0\ub9cc \ud604\uc7ac \ubcf5\uc81c\ud560 \ub370\uc774\ud130\uac00 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \ud574\ub2f9 \ubd80\ubd84\uc740 \uc0dd\ub7b5\ud588\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","SOURCE_HOST, SOURCE_LOG_FILE, SOURCE_LOG_POS \ub97c \uc801\uc808\ud788 \ubcc0\uacbd\ud55c\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-mysql"},"STOP REPLICA;\n\nCHANGE REPLICATION SOURCE TO \nSOURCE_HOST='172.29.0.2', \nSOURCE_USER='user', \nSOURCE_PASSWORD='password', \nSOURCE_LOG_FILE='mysql-bin.000001', \nSOURCE_LOG_POS=0, \nGET_SOURCE_PUBLIC_KEY=1;\n\nSTART REPLICA;\n")),(0,r.kt)("h3",{id:"\uc124\uc815-\ud655\uc778"},"\uc124\uc815 \ud655\uc778"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-mysql"},"SHOW REPLICA STATUS;\n\n+----------------------------------+-------------+-------------+-------------+---------------+------------------+---------------------+------------------------+---------------+-----------------------+--------------------+---------------------+-----------------+---------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+--------------------------------------+-------------------------+-----------+---------------------+----------------------------------------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+-------------------+---------------+----------------------+--------------+--------------------+------------------------+-----------------------+-------------------+\n| Replica_IO_State                 | Source_Host | Source_User | Source_Port | Connect_Retry | Source_Log_File  | Read_Source_Log_Pos | Relay_Log_File         | Relay_Log_Pos | Relay_Source_Log_File | Replica_IO_Running | Replica_SQL_Running | Replicate_Do_DB | Replicate_Ignore_DB | Replicate_Do_Table | Replicate_Ignore_Table | Replicate_Wild_Do_Table | Replicate_Wild_Ignore_Table | Last_Errno | Last_Error | Skip_Counter | Exec_Source_Log_Pos | Relay_Log_Space | Until_Condition | Until_Log_File | Until_Log_Pos | Source_SSL_Allowed | Source_SSL_CA_File | Source_SSL_CA_Path | Source_SSL_Cert | Source_SSL_Cipher | Source_SSL_Key | Seconds_Behind_Source | Source_SSL_Verify_Server_Cert | Last_IO_Errno | Last_IO_Error | Last_SQL_Errno | Last_SQL_Error | Replicate_Ignore_Server_Ids | Source_Server_Id | Source_UUID                          | Source_Info_File        | SQL_Delay | SQL_Remaining_Delay | Replica_SQL_Running_State                                | Source_Retry_Count | Source_Bind | Last_IO_Error_Timestamp | Last_SQL_Error_Timestamp | Source_SSL_Crl | Source_SSL_Crlpath | Retrieved_Gtid_Set | Executed_Gtid_Set | Auto_Position | Replicate_Rewrite_DB | Channel_Name | Source_TLS_Version | Source_public_key_path | Get_Source_public_key | Network_Namespace |\n+----------------------------------+-------------+-------------+-------------+---------------+------------------+---------------------+------------------------+---------------+-----------------------+--------------------+---------------------+-----------------+---------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+--------------------------------------+-------------------------+-----------+---------------------+----------------------------------------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+-------------------+---------------+----------------------+--------------+--------------------+------------------------+-----------------------+-------------------+\n| Waiting for source to send event | 172.25.0.3  | user        |        3306 |            60 | mysql-bin.000003 |                1082 | mysql-relay-bin.000002 |           868 | mysql-bin.000003      | Yes                | Yes                 |                 |                     |                    |                        |                         |                             |          0 |            |            0 |                1082 |            1078 | None            |                |             0 | No                 |                    |                    |                 |                   |                |                     0 | No                            |             0 |               |              0 |                |                             |                1 | 5a396b02-41c6-11ee-a56d-0242ac190003 | mysql.slave_master_info |         0 |                NULL | Replica has read all relay log; waiting for more updates |              86400 |             |                         |                          |                |                    |                    |                   |             0 |                      |              |                    |                        |                     1 |                   |\n+----------------------------------+-------------+-------------+-------------+---------------+------------------+---------------------+------------------------+---------------+-----------------------+--------------------+---------------------+-----------------+---------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+--------------------------------------+-------------------------+-----------+---------------------+----------------------------------------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+-------------------+---------------+----------------------+--------------+--------------------+------------------------+-----------------------+-------------------+\n")),(0,r.kt)("p",null,"Replica_IO_Running, Replica_SQL_Running \uac12\uc774 YES\ub77c\uba74 \uc815\uc0c1\uc801\uc73c\ub85c replication \uad6c\uc131\uc774 \uc644\ub8cc\ub41c \uac83\uc774\ub2e4.  "),(0,r.kt)("p",null,"\uc124\uc815\uc744 \ub9c8\uce5c \ud6c4 source db\uc5d0 \ub2e4\uc74c\uacfc \uac19\uc774 create table \uba85\ub839\uc5b4\ub97c \uc785\ub825\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","replica db\uc5d0 \ub3d9\uc77c\ud55c member table\uc774 \uc0dd\uc131\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE member\n(\n    id   BIGINT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255)\n);\n")),(0,r.kt)("h2",{id:"\uc2a4\ud504\ub9c1-\ubd80\ud2b8\ub85c-db-\uc811\uadfc\ud558\uae30"},"\uc2a4\ud504\ub9c1 \ubd80\ud2b8\ub85c DB \uc811\uadfc\ud558\uae30"),(0,r.kt)("p",null,"\uc77c\ubc18\uc801\uc778 \ud2b8\ub79c\uc7ad\uc158\uc758 \uacbd\uc6b0 source, \uc77d\uae30 \uc804\uc6a9 \ud2b8\ub79c\uc7ad\uc158\uc778 \uacbd\uc6b0 replica\ub85c \uc694\uccad\uc774 \uac00\ub3c4\ub85d \uad6c\uc131\ud574\ubcf4\uc790.  "),(0,r.kt)("h3",{id:"environment-\uc124\uc815"},"Environment \uc124\uc815"),(0,r.kt)("p",null,"\ub2e4\uc74c\uacfc \uac19\uc774 source, replica\ub85c \uad6c\ubd84\ud558\uc5ec \uc124\uc815\ud55c\ub2e4. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml",metastring:'title="application.yml"',title:'"application.yml"'},"spring:\n  datasource:\n    source:\n      username: user\n      password: password\n      driver-class-name: com.mysql.cj.jdbc.Driver\n      jdbc-url: jdbc:mysql://localhost:13306/db\n    replica:\n      username: user\n      password: password\n      driver-class-name: com.mysql.cj.jdbc.Driver\n      jdbc-url: jdbc:mysql://localhost:13307/db\n")),(0,r.kt)("h3",{id:"datasourcetype-\uc124\uc815"},"DataSourceType \uc124\uc815"),(0,r.kt)("p",null,"\ub2e8\uc21c \ubb38\uc790\uc5f4\ub85c\ub3c4 \uad6c\ubd84\ud560 \uc218 \uc788\uc9c0\ub9cc, enum\uc744 \uc774\uc6a9\ud574\uc11c \ud2b8\ub79c\uc7ad\uc158\uc744 \uad6c\ubd84\ud558\ub3c4\ub85d \uc0dd\uc131\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","Key\ub294 \ucd94\ud6c4\uc5d0 \ube48 \uc124\uc815\uc5d0 \uc0ac\uc6a9\ud55c\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="DataSourceType"',title:'"DataSourceType"'},'public enum DataSourceType {\n    SOURCE(SOURCE_NAME),\n    REPLICA(REPLICA_NAME),\n    ;\n\n    private final String key;\n\n    DataSourceType(String key) {\n        this.key = key;\n    }\n\n    public static class Key {\n        public static final String ROUTING_NAME = "ROUTING";\n        public static final String SOURCE_NAME = "SOURCE";\n        public static final String REPLICA_NAME = "REPLICA";\n    }\n}\n')),(0,r.kt)("h3",{id:"abstractroutingdatasource-\uc124\uc815"},"AbstractRoutingDataSource \uc124\uc815"),(0,r.kt)("p",null,"\uc2a4\ud504\ub9c1\uc774 \uc9c0\uc6d0\ud574\uc8fc\ub294 AbstractRoutingDataSource\ub97c \uc0c1\uc18d\ubc1b\uc544 \ud2b8\ub79c\uc7ad\uc158\uc758 \uc77d\uae30 \uc5ec\ubd80\uc5d0 \ub530\ub77c \ub2e4\ub978 DataSource\ub97c \ud5a5\ud558\ub3c4\ub85d \uc124\uc815\ud55c\ub2e4.  "),(0,r.kt)("p",null,"\uc815\uc801 \ud329\ud130\ub9ac \uba54\uc11c\ub4dc\ub294 Map<DataSourceKey, DataSource>\uc5d0 \ud574\ub2f9\ud558\ub294 \uac12\uc744 \ubc1b\uc544 \ub370\uc774\ud130 \uc18c\uc2a4\ub97c \uc124\uc815\ud55c\ub2e4.  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"setDefaultTargetDataSource: \uae30\ubcf8 \ub370\uc774\ud130 \uc18c\uc2a4\ub97c \uc124\uc815\ud55c\ub2e4.  "),(0,r.kt)("li",{parentName:"ul"},"setTargetDataSources: \ub9f5 \ud615\ud0dc\ub85c \ubc1b\uc740 \ub370\uc774\ud130 \uc18c\uc2a4 \uac12\ub4e4\uc744 \uc124\uc815\ud55c\ub2e4.   ")),(0,r.kt)("p",null,"determineCurrentLookupKey\ub97c \uc624\ubc84\ub77c\uc774\ub529\ud558\uc5ec \ud2b8\ub79c\uc7ad\uc158\uc758 \uc77d\uae30 \uc5ec\ubd80\uc5d0 \ub530\ub77c \ub2e4\ub978 DataSourceType\uc744 \ubc18\ud658\ud558\ub3c4\ub85d \uc124\uc815\ud55c\ub2e4.  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"isCurrentTransactionReadOnly() \uba54\uc11c\ub4dc\ub97c \ud1b5\ud574 \ud2b8\ub79c\uc7ad\uc158\uc774 \uc77d\uae30 \uc804\uc6a9\uc778\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  "),(0,r.kt)("li",{parentName:"ul"},"DataSourceType\uc744 \ubc18\ud658\ud558\ub3c4\ub85d \uc124\uc815\ud558\uace0, \ubc18\ud658\ud55c \uac12\uc5d0 \ud574\ub2f9\ud558\ub294 \ub370\uc774\ud130 \uc18c\uc2a4\uac00 \uc0ac\uc6a9\ub41c\ub2e4.  ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="RoutingDataSource"',title:'"RoutingDataSource"'},'public class RoutingDataSource extends AbstractRoutingDataSource {\n\n    private final Logger log = LoggerFactory.getLogger(getClass());\n\n    public static RoutingDataSource from(Map<Object, Object> dataSources) {\n        RoutingDataSource routingDataSource = new RoutingDataSource();\n        routingDataSource.setDefaultTargetDataSource(dataSources.get(DataSourceType.SOURCE));\n        routingDataSource.setTargetDataSources(dataSources);\n        return routingDataSource;\n    }\n\n    @Override\n    protected Object determineCurrentLookupKey() {\n        boolean readOnly = TransactionSynchronizationManager.isCurrentTransactionReadOnly();\n\n        if (readOnly) {\n            log.info("readOnly = true, request to replica");\n            return DataSourceType.REPLICA;\n        }\n        log.info("readOnly = false, request to source");\n        return DataSourceType.SOURCE;\n    }\n}\n')),(0,r.kt)("h3",{id:"datasource-\uc124\uc815"},"DataSource \uc124\uc815"),(0,r.kt)("p",null,"\uc704\uc5d0\uc11c\ubd80\ud130 \uc21c\uc11c\ub300\ub85c Source, Replica, RoutingDataSource, LazyConnectionDataSourceProxy \uc124\uc815\uc774\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc2a4\ud504\ub9c1\uc740 \ud2b8\ub79c\uc7ad\uc158 \uc2dc\uc791\uc2dc\uc5d0 \ucee4\ub125\uc158\uc758 \uc0ac\uc6a9\uc5ec\ubd80\uc640 \uc0c1\uad00\uc5c6\uc774 \ucee4\ub125\uc158\uc744 \ud655\ubcf4\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub530\ub77c\uc11c readOnly \ud2b8\ub79c\uc7ad\uc158\uc774 \uc124\uc815\ub41c \uba54\uc11c\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub354\ub77c\ub3c4 \ubbf8\ub9ac \ud655\ubcf4\ub41c \ucee4\ub125\uc158\uc744 \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 replica db\ub85c \uc694\uccad\uc744 \ud558\uc9c0 \uc54a\uace0 setDefaultTargetDataSource\ub85c \uc124\uc815\ud55c source db\ub85c \uc694\uccad\uc744 \ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","LazyConnectionDataSourceProxy\ub97c \uc124\uc815\ud558\ub294 \uacbd\uc6b0 \uc2e4\uc81c DataSource\ub97c \uc0ac\uc6a9\ud558\ub294 \uc2dc\uc810\uc5d0 \ucee4\ub125\uc158\uc744 \ud68d\ub4dd\ud574\uc11c \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \uc124\uc815\ud55c\ub300\ub85c replica db\ub85c \uc870\ud68c \uc694\uccad\uc744 \ud55c\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="DataSourceConfiguration"',title:'"DataSourceConfiguration"'},'@Configuration\npublic class DataSourceConfiguration {\n\n    @Bean\n    @Qualifier(SOURCE_NAME)\n    @ConfigurationProperties(prefix = "spring.datasource.source")\n    public DataSource sourceDataSource() {\n        return DataSourceBuilder.create().build();\n    }\n\n    @Bean\n    @Qualifier(REPLICA_NAME)\n    @ConfigurationProperties(prefix = "spring.datasource.replica")\n    public DataSource replicaDataSource() {\n        return DataSourceBuilder.create().build();\n    }\n\n    @Bean\n    @Qualifier(ROUTING_NAME)\n    public DataSource routingDataSource(\n            @Qualifier(SOURCE_NAME) DataSource sourceDataSource,\n            @Qualifier(REPLICA_NAME) DataSource replicaDataSource\n    ) {\n        return RoutingDataSource.from(Map.of(\n                DataSourceType.SOURCE, sourceDataSource,\n                DataSourceType.REPLICA, replicaDataSource\n        ));\n    }\n\n    @Bean\n    @Primary\n    public DataSource dataSource(\n            @Qualifier(ROUTING_NAME) DataSource routingDataSource\n    ) {\n        return new LazyConnectionDataSourceProxy(routingDataSource);\n    }\n}\n')),(0,r.kt)("p",null,"\ucd5c\uc885\uc801\uc73c\ub85c DataSource \ube48\uc740 \ub2e4\uc74c\uacfc \uac19\uc740 \ud615\ud0dc\uac00 \ub41c\ub2e4.  "),(0,r.kt)("mermaid",{value:"graph LR\n  DSP[LazyConnectionDataSourceProxy] --\x3e RDS[RoutingDataSource]\n\tRDS --\x3e S[SourceDataSource]\n\tRDS --\x3e R[ReplicaDataSource]"}),(0,r.kt)("h3",{id:"\ub3d9\uc791-\ud655\uc778"},"\ub3d9\uc791 \ud655\uc778"),(0,r.kt)("p",null,"\uac04\ub2e8\ud558\uac8c \ud14c\uc2a4\ud2b8\ub97c \uc791\uc131\ud574\uc11c \uc124\uc815\ud55c\ub300\ub85c \ub3d9\uc791\uc774 \ub418\ub294\uc9c0 \ud655\uc778\ud574\ubcf4\uc558\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","save \uba54\uc11c\ub4dc\uc758 \uacbd\uc6b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"@Transactional"),", findById \uba54\uc11c\ub4dc\uc758 \uacbd\uc6b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"@Transactional(readOnly = true)"),"\uac00 \uc124\uc815\ub418\uc5b4\uc788\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub85c\uadf8\ub97c \ud1b5\ud574 save\uc758 \uacbd\uc6b0 source db\ub85c findById\uc758 \uacbd\uc6b0 replica db\ub85c \uc694\uccad\uc744 \ud558\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="MemberServiceTest"',title:'"MemberServiceTest"'},'@SpringBootTest\nclass MemberServiceTest {\n\n    @Autowired\n    private MemberService memberService;\n\n    @Test\n    void \uc0ac\uc6a9\uc790\ub97c_\uc800\uc7a5\ud55c\ub2e4() {\n        // RoutingDataSource log: readOnly = false\n        memberService.save("bbiac");\n    }\n\n    @Test\n    void \uc0ac\uc6a9\uc790\ub97c_\uc870\ud68c\ud55c\ub2e4() {\n        // RoutingDataSource log: readOnly = true\n        assertThatThrownBy(() -> memberService.findById(MAX_VALUE))\n                .isInstanceOf(NoSuchElementException.class);\n    }\n}\n')),(0,r.kt)("p",null,"DB\uc5d0\uc11c\ub294 \ud655\uc778\ud558\ub824\uba74 root \uacc4\uc815\uc73c\ub85c \uc811\uc18d\ud55c \ud6c4 general log\ub97c \ud65c\uc131\ud654 \uc2dc\ud0a8\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SET GLOBAL log_output = 'table';\nSET GLOBAL general_log = 1;\n")),(0,r.kt)("p",null,"general log\ub97c \ud65c\uc131\ud654 \ud55c \ud6c4 \uc77d\uae30 \uc804\uc6a9 \uba54\uc11c\ub4dc\ub97c \uc2e4\ud589\ud55c\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","server_id, \uc2e4\ud589\ud55c \ucffc\ub9ac\ubb38\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT user_host, thread_id, server_id, convert(argument using utf8) FROM mysql.general_log where argument like '%select%';\n\n+----------------------------+-----------+-----------+-----------------------------------------------------------------------------+\n| user_host                  | thread_id | server_id | convert(argument using utf8)                                                |\n+----------------------------+-----------+-----------+-----------------------------------------------------------------------------+\n| user[user] @  [172.25.0.1] |       277 |         2 | select m1_0.id,m1_0.name from member m1_0 where m1_0.id=9223372036854775807 |\n+----------------------------+-----------+-----------+-----------------------------------------------------------------------------+\n")),(0,r.kt)("p",null,"\ud655\uc778 \ud6c4 general log\ub97c \ube44\ud65c\uc131\ud654 \ud55c \ud6c4 \ube44\ud65c\uc131\ud654 \ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud55c\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SET GLOBAL general_log = 0;\nSHOW VARIABLES LIKE '%general%';\n\n+------------------+---------------------------------+\n| Variable_name    | Value                           |\n+------------------+---------------------------------+\n| general_log      | OFF                             |\n| general_log_file | /var/lib/mysql/4b6b9db98290.log |\n+------------------+---------------------------------+\n")),(0,r.kt)("h2",{id:"\ucc38\uace0-\uc790\ub8cc"},"\ucc38\uace0 \uc790\ub8cc"),(0,r.kt)("p",null,"16\uc7a5 \ubcf5\uc81c, Real MySQL 8.0 - \ubc31\uc740\ube48, \uc774\uc131\uc6b1",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.1/en/replication.html"},"Replication, MySQL Docs"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://huisam.tistory.com/entry/mysql-replication"},"MySql - Master Slave Replication \uad6c\uc870 \ub9cc\ub4e4\uc5b4\ubcf4\uae30"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://cheese10yun.github.io/spring-transaction/"},"Spring \ub808\ud50c\ub9ac\ucf00\uc774\uc158 \ud2b8\ub79c\uc7ad\uc158 \ucc98\ub9ac \ubc29\uc2dd"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kwon37xi/replication-datasource"},"replication-datasource"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.linkedin.com/pulse/simplified-guide-mysql-replication-docker-compose-rakesh-shekhawat/"},"Simplified Guide to MySQL Replication with Docker Compose"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.daleseo.com/dockerfile/"},"Dockerfile\uc5d0\uc11c \uc790\uc8fc \uc4f0\uc774\ub294 \uba85\ub839\uc5b4"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.1/en/change-replication-source-to.html"},"CHANGE REPLICATION SOURCE TO Statement"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://kwonnam.pe.kr/wiki/springframework/lazyconnectiondatasourceproxy"},"LazyConnectionDataSourceProxy"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://hudi.blog/database-replication-with-springboot-and-mysql/"},"\ub370\uc774\ud130\ubca0\uc774\uc2a4 \ub808\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud1b5\ud55c \ucffc\ub9ac \uc131\ub2a5 \uac1c\uc120 (feat. Mysql, SpringBoot)"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://chagokx2.tistory.com/100"},"\ubd80\ud558 \ubd84\uc0b0\uc744 \uc704\ud55c MySQL Replication \uad6c\uc131 \ubc0f \ucffc\ub9ac \uc694\uccad \ubd84\uae30"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/get-started/08_using_compose/"},"Use Docker Compose, Docker")))}d.isMDXComponent=!0}}]);